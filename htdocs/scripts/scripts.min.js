$(function() {
 /* PREVENT SCROLL ON TABLET */
 document.ontouchmove = function(event){
     event.preventDefault();
 };

 /* SWIPE ADMIN */
 $("#swipe").dragend({
   afterInitialize: function() {
     this.container.style.visibility = "visible";
     $('.parameters').remove('hidden');
   }
 })
 

 /* ANIM INPUT PSEUDO + MAIL */
 myInput = document.querySelectorAll(".input_login");
 for (element of myInput) {
   element.addEventListener("keyup", function() {
     this.size = this.value.length;
     //alert(this.value.length);
   });
 }

  $( ".section-right" ).tabs();
  
  $('.link_container_tab').on('click', function(){
    $('.link_container_tab').removeClass('active-tabs');
    $(this).addClass('active-tabs');
  })

  $('.box_item').on('click', function(){
    $(this).addClass('selected');
  })

  /* ANIM INPUT PSEUDO + MAIL */
  myInput = document.querySelectorAll(".input_login");
  for (element of myInput) {
    element.addEventListener("keyup", function() {
      this.size = this.value.length;
      //alert(this.value.length);
    });
  }

  //@prepros-append components/_photo.js
  //@prepros-append components/_print-and-share.js
  //@prepros-append components/_admin.js
});














/* DRAG AND DROP */

$('.box_item').on('click', function(){
  var itemSource = $( this ).find('img').attr("src");
  var itemClass = $(this).attr("data-item");
  var d = $( this ).find("path").attr('d');
  var viewBox = $( this ).find("svg").attr('viewBox');
  $('.box_item').removeClass('selected');
  $('.box_thumbnail').removeClass('selected');
 
  if(!$(this).hasClass('active')){
    $('<div data-item="'+itemClass+'"><li class="box_thumbnail selected '+itemClass+'" data-item="'+itemClass+'"><svg viewBox="'+viewBox+'"><path class="cls-1" d="'+d+'" ></svg></li></div>').appendTo('.drag-zone').draggable({containment : $('main')});
    $('<li class="box_thumbnail selected '+itemClass+'" data-item="'+itemClass+'"><svg viewBox="'+viewBox+'"><path class="cls-1" d="'+d+'" ></svg></li>').appendTo('.container_items_thumbnail');
    $(this).addClass('active selected');
  }
  else{
    $(this).add('.box_thumbnail.'+itemClass+'').addClass('selected');
  }

  highLighter($(this));
})





var svg = $( this ).find('img').attr("class");

$('.box_item').on("click", function(){
  $(".box_item active"+svg+"").clone().appendTo(".box_thumbnail img");
});

window.makeClone = function (){
    var cloneSVG = $('svg').clone();
    cloneSVG.appendTo('.test');
}
window.removeClone = function (){
    $('svg:last').remove();
}





$('main').droppable({
  accept : ".drag",
  hoverClass : "active-trash",
  drop: function(event, ui){
    var dragClass = $(ui.draggable).attr("data-item");
    $('.box_thumbnail.'+dragClass+'').remove();
    $(ui.draggable).remove();
    $('.box_item.'+dragClass+'').removeClass('active selected');
  }
})

$('.drag-zone').droppable({
  accept: ".drag",
  greedy: true,
  over: function(event, ui){
    $(ui.draggable).removeClass('hover-trash').css("background", "red");
  },
  out: function(event, ui){
    $(ui.draggable).addClass('hover-trash').css("background", "green");
  }
})

/////////

$( ".btn_reset" ).click(function(shake){
  $( ".container_items_thumbnail" ).children().addClass("shake"); 
  $(".background-popup").removeAttr("hidden");
  $(".popup").removeAttr("hidden");
  return shake;
});

// réponse oui
$( ".answer-yes" ).click(function(yes){
  //alert('clic yes');
  $( ".container_items_thumbnail" ).children().remove();
  $(".box_item").removeClass('active selected');
  $('.drag').remove();
  $(".popup").attr("hidden", true);
  $(".background-popup").attr("hidden", true);
});

// réponse non
$( ".answer-no" ).click(function(no){
  //alert('clic yes');
  $(".popup").attr("hidden", true);
  $(".background-popup").attr("hidden", true);
  $(".container_items_thumbnail").children().removeClass("shake");
});

$('.container_items_thumbnail').on("click", ".box_thumbnail", function(){
  var itemClass = $(this).attr("data-item");
  $('.box_thumbnail, .box_item').removeClass('selected');
  $(this).add('.box_item.'+itemClass+'').addClass('selected');
  highLighter($(this));
});

function highLighter(item){
  var itemClass = item.attr('data-item');
  $('.drag').css("zIndex", '1');
  $('.drag.'+itemClass+'').css("zIndex", '10');
}


/* btn trash */
$('.box_thumbnail selected').on('click', function(){
  $('.btn_trash').removeAttr('hidden');
});

$('.btn_trash').on('click', function(){
  $('.container_items_thumbnail').children().remove();
  $(".box_item").removeClass('active selected');
  $('.drag').remove();
});
/* PHOTO BUTTON + PARAMETERS */
$('.btn_photo').on('click', function(){
  if($(this).hasClass('btn_photo__take')) {
    $(this).removeClass('btn_photo__take');
    $(this).addClass('btn_photo__editor');
  }
  else {
    $('.container_photo-parameters').removeClass('hidden');
  }
});

$('.btn_photo-parameters__del').on('click', function(){
  $(this).parent().addClass('hidden');
  $('.btn_photo').removeClass('btn_photo__editor').addClass('btn_photo__take')
});

$('.btn-storage').on('click', function(){
    $('.header_print-and-share, .container_print-and-share').addClass('blur');
    $('.container_print-and-share__fade-in').css("display", "flex");
    $('.popup_print-and-share, .container_print-and-share__fade-in:before,.text_pop_action:after ').addClass('bop');
});

$('.print').on('click', function(){
    $('.li_pop_1').css("display", "none");
    $('.li_pop_2').css("display", "block");
    $('.li_pop_3').css("display", "block");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton badge sera imprimé d'ici quelques minutes</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de partager ton design sur facebook</p>");
});

$('.mail').on('click', function(){
    $('.li_pop_1').css("display", "block");
    $('.li_pop_2').css("display", "none");
    $('.li_pop_3').css("display", "block");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton avatar a bien été envoyé!</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de partager ton design sur facebook</p>");
});

$('.face').on('click', function(){
    $('.li_pop_1').css("display", "block");
    $('.li_pop_2').css("display", "block");
    $('.li_pop_3').css("display", "none");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton avatar a bien été publié sur facebook!</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de te l'envoyer par email</p>");
});

$(function() {
        var myButton = document.querySelector('#admin_login'); 

	myButton.onclick = function (event){ 
		event.preventDefault(); 

		myLogField = document.querySelector('#admin_pseudo'); 
		myLog = myLogField.value; 
        myPassField = document.querySelector('#admin_pass');
        myPass = myPassField.value;

		if (myLog == 'Admin' && myPass == 'pass'){

            $('.finger-scroll, .admin_connexion > input, button, a').css("display", "none");
            $('.title_admin:after').css("display", "block");
            $(".title_admin").html('Paramètres'); // changement h2
            $('#admin_switch').css("display", "flex"); // apparition ON/OFF print
            $('#admin_delog').css("display", "block");// apparitiontitre + button

            
		}
		else if (myLog != 'Admin' && myPass == 'pass'){
			alert("Attention! L'identifiant est incorrect")
		}
        else if (myLog == 'Admin' && myPass != 'pass'){
			alert("Attention! Le mot de passe est incorrect")
		}
        else if (myLog == '' && myPass == ''){
			alert("Attention! Veuillez renseigner tous les chants")
		}
		else{
			alert("Attention! L'identifiant ou le mot de passe est incorrect")
		}
	};

    // Apparition input drive
    $(".input_drive").hide();
    $("#switch-shadow").click(function(){
        $(".input_drive").toggle();
        if( $("#switch-shadow").is(':checked') ){
            $("#switch-shadow").change($(".etat").html('activé'));}
        else{ $("#switch-shadow").change($(".etat").html('désactivé'));}
    });

});
